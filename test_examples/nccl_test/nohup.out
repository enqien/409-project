====================================================================================================
1/72 
{'TEST_NAME': 'all_reduce_perf', 'SIZE': '8MB', 'ITTER_NUM': 12500, 'SERVER_GPU': 4, 'CLIENT_GPU': 4, 'agg_iters': 10, 'NCCL_IB_QPS_PER_CONNECTION': 1}
Running Command at Host >>>>>>>>>>   nsn160-58.us.oracle.com
Running TIME at >>>>>>>>>>   2023-07-10 09:38:11
Making LOG PATH >>>>>>>>>>   /root/OHD_Perfy/LOGS/LOG_nccl/LOG_nccl_1689007091
Config >>>>>>>>>>    
       BASE_URL : http://nsn160-58:8000/perfy
       task_category : nccl
       task_name : NCCL_4PORT
       template : nccl/nccl.html
       index_columns : ['TYPE', 'GPU_Num', 'Port_Num', 'QP', 'SIZE', 'Aggregation_Count']
       feature_columns : {'out_algbw(Gbps)': 'max', 'out_busbw(Gbps)': 'max', 'in_algbw(Gbps)': 'max', 'in_busbw(Gbps)': 'max', 'avg_switch_in(Gbps)': 'max', 'avg_switch_out(Gbps)': 'min'}
       user_name : junewu
       user_password : ********
End Config >>>>>>>>>>   



Parameters >>>>>>>>>>    
       TEST_NAME : all_reduce_perf
       SIZE : 8MB
       ITTER_NUM : 12500
       SERVER_GPU : 4
       CLIENT_GPU : 4
       agg_iters : 10
       NCCL_IB_QPS_PER_CONNECTION : 1
       NCCL_HOME : /root/nccl-bin
       MPI_HOME : /usr/mpi/gcc/openmpi-4.1.5a1/bin/mpirun
       SERVERS : SERVER
       CLIENTS : CLIENT
       Switch_Hostname : 10.134.160.53
       Switch_Password : Pass1234
       bind_to : numa
       NCCL_IB_TC : 41
       NCCL_IB_SL : 0
       PORT : 4
End Parameters >>>>>>>>>>   



#!/bin/bash

SERVER_Port1=nsn160-58
SERVER_Port1_DEV=mlx5_2
SERVER_Port1_NETDEV=ens800f0np0
SERVER_Port1_NETDEV_IP=192.168.20.58
SERVER_Port1_GID=3

SERVER_Port2=nsn160-58
SERVER_Port2_DEV=mlx5_3
SERVER_Port2_NETDEV=ens800f1np1
SERVER_Port2_NETDEV_IP=192.168.21.58
SERVER_Port2_GID=3

SERVER_Port3=nsn160-58
SERVER_Port3_DEV=mlx5_4
SERVER_Port3_NETDEV=ens840f0np0
SERVER_Port3_NETDEV_IP=192.168.30.58
SERVER_Port3_GID=3

SERVER_Port4=nsn160-58
SERVER_Port4_DEV=mlx5_5
SERVER_Port4_NETDEV=ens840f1np1
SERVER_Port4_NETDEV_IP=192.168.31.58
SERVER_Port4_GID=3

CLIENT_Port1=nsn160-62
CLIENT_Port1_DEV=mlx5_2
CLIENT_Port1_NETDEV=ens800f0np0
CLIENT_Port1_NETDEV_IP=192.168.20.62
CLIENT_Port1_GID=3

CLIENT_Port2=nsn160-62
CLIENT_Port2_DEV=mlx5_3
CLIENT_Port2_NETDEV=ens800f1np1
CLIENT_Port2_NETDEV_IP=192.168.21.62
CLIENT_Port2_GID=3

CLIENT_Port3=nsn160-62
CLIENT_Port3_DEV=mlx5_4
CLIENT_Port3_NETDEV=ens840f0np0
CLIENT_Port3_NETDEV_IP=192.168.30.62
CLIENT_Port3_GID=3

CLIENT_Port4=nsn160-62
CLIENT_Port4_DEV=mlx5_5
CLIENT_Port4_NETDEV=ens840f1np1
CLIENT_Port4_NETDEV_IP=192.168.31.62
CLIENT_Port4_GID=3

--------------------------
System info from all nodes
--------------------------

^^^^ SERVER_Port1=nsn160-58 ens800f0np0
HOSTNAME:nsn160-58.us.oracle.com
SERVER_TYPE:NA
SERVER:ORACLE SERVER X9-2c
BIOS:BIOS: 66090200
CPU:Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz
MEMORY:0x DIMM(s)
HCA:Oracle ConnectX-6 Dx EN adapter card, 2x100GbE, Dual-port QSFP -Prime
HCA_FW:22.36.1010 (ORC0000000005)
KERNEL:5.4.17-2136.307.3.1.el8uek.x86_64
ILOM:Version: 5.1.1.91 r150981
IMAGE:NA
OS:Red Hat Enterprise Linux release 8.6 (Ootpa)
INTERFACE:ens800f0np0
INTERFACE_INFO: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000;        inet 192.168.20.58  netmask 255.255.255.0  broadcast 192.168.20.255;        ether b8:ce:f6:b8:db:3c  txqueuelen 1000  (Ethernet);        RX packets 192039  bytes 16102693 (15.3 MiB);        RX errors 0  dropped 0  overruns 0  frame 0;        TX packets 190861  bytes 15617588 (14.8 MiB);        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0;;
^^^^

^^^^ SERVER_Port2=nsn160-58 ens800f1np1
HOSTNAME:nsn160-58.us.oracle.com
SERVER_TYPE:NA
SERVER:ORACLE SERVER X9-2c
BIOS:BIOS: 66090200
CPU:Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz
MEMORY:0x DIMM(s)
HCA:Oracle ConnectX-6 Dx EN adapter card, 2x100GbE, Dual-port QSFP -Prime
HCA_FW:22.36.1010 (ORC0000000005)
KERNEL:5.4.17-2136.307.3.1.el8uek.x86_64
ILOM:Version: 5.1.1.91 r150981
IMAGE:NA
OS:Red Hat Enterprise Linux release 8.6 (Ootpa)
INTERFACE:ens800f1np1
INTERFACE_INFO: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000;        inet 192.168.21.58  netmask 255.255.255.0  broadcast 192.168.21.255;        ether b8:ce:f6:b8:db:3d  txqueuelen 1000  (Ethernet);        RX packets 65335  bytes 4255349 (4.0 MiB);        RX errors 0  dropped 0  overruns 0  frame 0;        TX packets 66329  bytes 4339340 (4.1 MiB);        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0;;
^^^^

^^^^ SERVER_Port3=nsn160-58 ens840f0np0
HOSTNAME:nsn160-58.us.oracle.com
SERVER_TYPE:NA
SERVER:ORACLE SERVER X9-2c
BIOS:BIOS: 66090200
CPU:Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz
MEMORY:0x DIMM(s)
HCA:Oracle ConnectX-6 Dx EN adapter card, 2x100GbE, Dual-port QSFP -Aux[1]
HCA_FW:22.36.1010 (ORC0000000005)
KERNEL:5.4.17-2136.307.3.1.el8uek.x86_64
ILOM:Version: 5.1.1.91 r150981
IMAGE:NA
OS:Red Hat Enterprise Linux release 8.6 (Ootpa)
INTERFACE:ens840f0np0
INTERFACE_INFO: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000;        inet 192.168.30.58  netmask 255.255.255.0  broadcast 192.168.30.255;        ether b8:ce:f6:b8:db:40  txqueuelen 1000  (Ethernet);        RX packets 136488  bytes 9496245 (9.0 MiB);        RX errors 0  dropped 0  overruns 0  frame 0;        TX packets 136390  bytes 9307932 (8.8 MiB);        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0;;
^^^^

^^^^ SERVER_Port4=nsn160-58 ens840f1np1
HOSTNAME:nsn160-58.us.oracle.com
SERVER_TYPE:NA
SERVER:ORACLE SERVER X9-2c
BIOS:BIOS: 66090200
CPU:Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz
MEMORY:0x DIMM(s)
HCA:Oracle ConnectX-6 Dx EN adapter card, 2x100GbE, Dual-port QSFP -Aux[1]
HCA_FW:22.36.1010 (ORC0000000005)
KERNEL:5.4.17-2136.307.3.1.el8uek.x86_64
ILOM:Version: 5.1.1.91 r150981
IMAGE:NA
OS:Red Hat Enterprise Linux release 8.6 (Ootpa)
INTERFACE:ens840f1np1
INTERFACE_INFO: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000;        inet 192.168.31.58  netmask 255.255.255.0  broadcast 192.168.31.255;        ether b8:ce:f6:b8:db:41  txqueuelen 1000  (Ethernet);        RX packets 238411  bytes 16082206 (15.3 MiB);        RX errors 0  dropped 0  overruns 0  frame 0;        TX packets 237743  bytes 15955347 (15.2 MiB);        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0;;
^^^^

^^^^ CLIENT_Port1=nsn160-62 ens800f0np0
HOSTNAME:nsn160-62
SERVER_TYPE:NA
SERVER:ORACLE SERVER X9-2c
BIOS:BIOS: 66090200
CPU:Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz
MEMORY:0x DIMM(s)
HCA:Oracle ConnectX-6 Dx EN adapter card, 2x100GbE, Dual-port QSFP -Prime
HCA_FW:22.36.1010 (ORC0000000005)
KERNEL:5.4.17-2136.307.3.1.el8uek.x86_64
ILOM:NA
IMAGE:NA
OS:Red Hat Enterprise Linux release 8.6 (Ootpa)
INTERFACE:ens800f0np0
INTERFACE_INFO: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000;        inet 192.168.20.62  netmask 255.255.255.0  broadcast 192.168.20.255;        ether b8:ce:f6:b8:e8:14  txqueuelen 1000  (Ethernet);        RX packets 190882  bytes 15619550 (14.8 MiB);        RX errors 0  dropped 0  overruns 0  frame 0;        TX packets 193112  bytes 16171117 (15.4 MiB);        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0;;
^^^^

^^^^ CLIENT_Port2=nsn160-62 ens800f1np1
HOSTNAME:nsn160-62
SERVER_TYPE:NA
SERVER:ORACLE SERVER X9-2c
BIOS:BIOS: 66090200
CPU:Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz
MEMORY:0x DIMM(s)
HCA:Oracle ConnectX-6 Dx EN adapter card, 2x100GbE, Dual-port QSFP -Prime
HCA_FW:22.36.1010 (ORC0000000005)
KERNEL:5.4.17-2136.307.3.1.el8uek.x86_64
ILOM:NA
IMAGE:NA
OS:Red Hat Enterprise Linux release 8.6 (Ootpa)
INTERFACE:ens800f1np1
INTERFACE_INFO: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000;        inet 192.168.21.62  netmask 255.255.255.0  broadcast 192.168.21.255;        ether b8:ce:f6:b8:e8:15  txqueuelen 1000  (Ethernet);        RX packets 66383  bytes 4343006 (4.1 MiB);        RX errors 0  dropped 0  overruns 0  frame 0;        TX packets 65257  bytes 4248474 (4.0 MiB);        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0;;
^^^^

^^^^ CLIENT_Port3=nsn160-62 ens840f0np0
HOSTNAME:nsn160-62
SERVER_TYPE:NA
SERVER:ORACLE SERVER X9-2c
BIOS:BIOS: 66090200
CPU:Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz
MEMORY:0x DIMM(s)
HCA:Oracle ConnectX-6 Dx EN adapter card, 2x100GbE, Dual-port QSFP -Aux[1]
HCA_FW:22.36.1010 (ORC0000000005)
KERNEL:5.4.17-2136.307.3.1.el8uek.x86_64
ILOM:NA
IMAGE:NA
OS:Red Hat Enterprise Linux release 8.6 (Ootpa)
INTERFACE:ens840f0np0
INTERFACE_INFO: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000;        inet 192.168.30.62  netmask 255.255.255.0  broadcast 192.168.30.255;        ether b8:ce:f6:b8:e8:18  txqueuelen 1000  (Ethernet);        RX packets 136413  bytes 9309318 (8.8 MiB);        RX errors 0  dropped 0  overruns 0  frame 0;        TX packets 136446  bytes 9492027 (9.0 MiB);        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0;;
^^^^

^^^^ CLIENT_Port4=nsn160-62 ens840f1np1
HOSTNAME:nsn160-62
SERVER_TYPE:NA
SERVER:ORACLE SERVER X9-2c
BIOS:BIOS: 66090200
CPU:Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz
MEMORY:0x DIMM(s)
HCA:Oracle ConnectX-6 Dx EN adapter card, 2x100GbE, Dual-port QSFP -Aux[1]
HCA_FW:22.36.1010 (ORC0000000005)
KERNEL:5.4.17-2136.307.3.1.el8uek.x86_64
ILOM:NA
IMAGE:NA
OS:Red Hat Enterprise Linux release 8.6 (Ootpa)
INTERFACE:ens840f1np1
INTERFACE_INFO: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000;        inet 192.168.31.62  netmask 255.255.255.0  broadcast 192.168.31.255;        ether b8:ce:f6:b8:e8:19  txqueuelen 1000  (Ethernet);        RX packets 237620  bytes 15946694 (15.2 MiB);        RX errors 0  dropped 0  overruns 0  frame 0;        TX packets 238939  bytes 16116022 (15.3 MiB);        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0;;
^^^^

SYSTEM `nsn160-58.us.oracle.com:ens800f0np0` Already In The Database at http://nsn160-58:8000/perfy/query_SystemsInfo
SYSTEM `nsn160-58.us.oracle.com:ens800f1np1` Already In The Database at http://nsn160-58:8000/perfy/query_SystemsInfo
SYSTEM `nsn160-58.us.oracle.com:ens840f0np0` Already In The Database at http://nsn160-58:8000/perfy/query_SystemsInfo
SYSTEM `nsn160-58.us.oracle.com:ens840f1np1` Already In The Database at http://nsn160-58:8000/perfy/query_SystemsInfo
SYSTEM `nsn160-62:ens800f0np0` Already In The Database at http://nsn160-58:8000/perfy/query_SystemsInfo
SYSTEM `nsn160-62:ens800f1np1` Already In The Database at http://nsn160-58:8000/perfy/query_SystemsInfo
SYSTEM `nsn160-62:ens840f0np0` Already In The Database at http://nsn160-58:8000/perfy/query_SystemsInfo
SYSTEM `nsn160-62:ens840f1np1` Already In The Database at http://nsn160-58:8000/perfy/query_SystemsInfo


 Running CMD ====> 
ssh root@nsn160-58 /usr/mpi/gcc/openmpi-4.1.5a1/bin/mpirun --allow-run-as-root -tag-output  -np 8 -H nsn160-58:4,nsn160-62:4 -bind-to numa -map-by slot -mca pml ucx -mca btl ^openib -x CUDA_DEVICE_ORDER=PCI_BUS_ID -x NCCL_IB_QPS_PER_CONNECTION=1 -x NCCL_IB_TC=41 -x NCCL_IB_HCA=mlx5_2,mlx5_3,mlx5_4,mlx5_5 -x NCCL_SOCKET_IFNAME=ens800f0np0,ens800f1np1,ens840f0np0,ens840f1np1 -x UCX_NET_DEVICES=ens800f0np0,ens800f1np1,ens840f0np0,ens840f1np1 /root/nccl-bin/all_reduce_perf -g 1 -t 1 -m 10 -b 8MB -e 8MB -p 0 -o sum -n 12500 | tee /root/OHD_Perfy/LOGS/LOG_nccl/LOG_nccl_1689007091/nsn160-58.out 


/usr/local/lib/python3.6/site-packages/paramiko/transport.py:32: CryptographyDeprecationWarning: Python 3.6 is no longer supported by the Python core team. Therefore, support for it is deprecated in cryptography. The next release of cryptography will remove support for Python 3.6.
  from cryptography.hazmat.backends import default_backend
show connected interface with `show int status`: 
Port       Name                        Status       Vlan     Duplex Speed  Type         Flags Encapsulation
Et1/1      nsn160-58-ens800f1+ens840f1 connected    1        full   100G   100GBASE-CR4                   
Et2/1      nsn160-62-ens800f0+ens840f0 connected    1        full   100G   100GBASE-CR4                   
Et3/1      nsn160-58-ens800f0+ens840f0 connected    1        full   100G   100GBASE-CR4                   
Et4/1      nsn160-62-ens800f1+ens840f1 connected    1        full   100G   100GBASE-CR4                   


show max in and out Mbps with `show int counter rate | nz`: 
Port      Name        Intvl   In Mbps      %  In Kpps  Out Mbps      % Out Kpps
Et1/1     nsn160-58-e  0:05   67224.7  67.7%     3024   67222.9  67.7%     3025
Et2/1     nsn160-62-e  0:05   67216.4  67.7%     3024   67215.9  67.7%     3024
Et3/1     nsn160-58-e  0:05   67227.0  67.7%     3025   67227.4  67.7%     3025
Et4/1     nsn160-62-e  0:05   67223.8  67.7%     3025   67223.4  67.7%     3024



{'TYPE': 'all_reduce_perf', 'GPU_Num': 4, 'Port_Num': 2, 'QP': 1, 'SIZE': '8MB', 'Aggregation_Count': 10, 'out_algbw(Gbps)': 74.32, 'out_busbw(Gbps)': 130.08, 'in_algbw(Gbps)': 74.4, 'in_busbw(Gbps)': 74.4, 'avg_switch_in(Gbps)': 134.45, 'avg_switch_out(Gbps)': 134.45}
post data to http://nsn160-58:8000/perfy/post_data 
GET CODE 200
post task to http://nsn160-58:8000/perfy/post_TasksInfo 
GET CODE 200
Total Running Time: 318s
SUCCESS!!!!
====================================================================================================
2/72 
.......